+++
title = "日志:每个程序员都应该了解的实时数据统一抽象"
date = 2019-02-15T09:44:41+08:00
draft = false

# Tags and categories
# For example, use `tags = []` for no tags, or the form `tags = ["A Tag", "Another Tag"]` for one or more tags.
tags = ["KVS", "CACHE", "LSM"]
categories = []

# Featured image
# To use, add an image named `featured.jpg/png` to your page's folder. 
[image]
  # Caption (optional)
  caption = ""

  # Focal point (optional)
  # Options: Smart, Center, TopLeft, Top, TopRight, Left, Right, BottomLeft, Bottom, BottomRight
  focal_point = ""
+++

在4年前加入广联达的时候，当时我们正在从传统的CS，单体的中心数据库，私有数据中心
向分布式，混合云架构演进。我们现在构建，部署，运营分布式关系/图像/键值数据库，
分布式检索，基于HDFS和对象存储的大数据分析平台。

在这个过程中，打心里认为学到的最重要的一个简单概念：日志。有时候我们叫它预写日志，
提交日志或事务日志。日志伴随着计算机出现就一直存在，是分布式数据系统和实时应用
架构的核心。

你不会完全理解数据库，NoSQL，键值存储，复制，paxos共识，hadoop，版本控制等任务
软件系统，除非完全理解日志。然而大部分程序员其实对日志并不熟悉。本贴将带你一步步
了解日志，包括什么是日志，如何有效的使用日志，通过日志来构建数据集成，实时数据处理
等业务系统。

# 第一个部分：什么是日志

日志可能是最简单的存储抽象。它是一个只可追加的，完全按照时间顺序记录的数据序列。
新的记录追加到日志存储的末尾。读取的时候从左向右处理。每一条记录条目分配了一个
唯一的日志序列号。

日志的存储次序定义了时间的概念，因为左边的日志条目始终比右边的日志存储的时间更早。
日志条目唯一序列号可以看做日志条目时间戳。把这个顺序定义为时间咋一看觉得奇怪，但
这个属性很方便的和特定的物理时钟隔离开来。这个属性很快证明是分布式系统所必须的。

日志条目的内容和格式不是本贴讨论内容要重点关心的。而且我们也不能无限的追加记录，
因为存储空间的限制。我们晚点开会谈到这一点。

因此，日志和文件，数据表没有根本不同。文件是字节数组，数据表是记录数组，日志只是
一个特定的类型的文件或数据表：日志数组按时间排序。

到此，你可能奇怪，我们有啥必要讨论如此简单的东西？只可追加的日志序列到底和数据系统
在哪些方面有关联呢？答案是日志有一个特殊的目的：记录什么时间发生了什么事。对分布式
系统来说，在很多方面，这都是核心问题。

但在我们继续讨论之前，让我先澄清一个让人困惑的事情。每一个程序员应该对另一种日志定义
非常熟悉并经常使用：非结构化的错误日志或跟踪日志，这些日志由应用程序利用syslog或
log4j写到本地文件系统。这类日志我们叫做应用日志。应用日志是我要描述的日志的退化形式。
他俩最大的区别是应用日志主要是用来运维开发人员读取使用，而我描述的数据日志主用来被
程序访问。

## 数据库日志

我不知道数据库日志的真正起源，可能就像二分查找一样，因为太过于简单，发明者都没有意识
到这是一个发明。它最早在IBM的System R中使用，用作各种数据结构和索引在崩溃的后同步。
为了保证数据的原子性和持久性，数据库把要修改的记录在提交前先写入日志。日志记录发生了什么
，是每个数据表或索引表的历史投影。因为日志被立即写入存储盘，被作为系统崩溃发生后进行
系统恢复有效的数据来源。

慢慢的，日志的使用范围从ACID的实现细节扩展到数据库间的数据复制机制。实践证明，这些
本地数据库数据的变更记录正是要保持远程的数据库副本同步所必需的。Oracle, MySQL和
PostgreSQL都有日志传送协议，在从库上做数据库复制。







[1] [What every software engineer should know about real-time data's unifying abstraction](https://engineering.linkedin.com/distributed-systems/log-what-every-software-engineer-should-know-about-real-time-datas-unifying)